# 数据分布拟合

## 数据概览
`summary`
- Mean
  - 反应数据大小
  - 对离群点敏感
  - 使样本的MSE(均方误差)最小
- Median
  - 对离群点不敏感
  - 使得样本的绝对误差最小
- Mode
  - 使用于非数字类型的数据
- Variability
  - 描述数据离散程度

### 应用
Z-score

## 常见分布
### 正态分布
这些函数是用于处理正态分布（也称为高斯分布）的统计函数，在统计学和数据分析中经常使用。它们的主要作用是计算、生成和转换正态分布的随机变量。

以下是对这些函数的简要介绍：

1. `rnorm(n, mean, sd)`: 生成**n个服从正态分布的随机变量**。`mean`参数表示均值（或期望值），`sd`参数表示标准差（或方差的平方根）。

2. `dnorm(x, mean, sd)`: 计算正态分布概率密度函数在给定x值处的概率密度值。`x`是要计算概率**密度的数值y值**，`mean`和`sd`分别是正态分布的均值和标准差。

3. `pnorm(x, mean, sd)`: 计算正态分布累积分布函数在给定x值处的**概率值从负无穷积分到x**。即计算正态分布随机变量小于等于x的概率。`x`是要计算概率的数值，`mean`和`sd`分别是正态分布的均值和标准差。

4. `qnorm(p, mean, sd)`: 计算正态分布的分位数（或百分位数）。给定概率p，函数返回正态分布随机变量的值，**求得到积分值的上限**，使得该值在累积分布函数中的概率等于p。`p`是要计算分位数的概率，`mean`和`sd`分别是正态分布的均值和标准差。

q和p是反函数

### 二项分布
#### 伯努利实验条件
- 试验可重复
- 试验之间独立
- 只有两种结果
- 每一次成功的概率p不变

#### 公式
期望$E(x) = np$
方差$Var(x) = np(1-p)$
伯努利二项式概率方程$P(x) = C_n^x \times p^x \times (1 - p)^{n-x}$

#### R function
1. `pbinom`函数：
   - 作用：计算二项分布累积概率。
   - 示例：假设有一个伯努利试验，成功的概率为0.3，进行了5次试验后，我们想计算得到至少3次成功的累积概率。可以使用 `pbinom(2, 5, 0.3, lower.tail = FALSE)`，其中，2是成功次数的下限（至少3次成功意味着失败最多2次），5是试验的总次数，0.3是成功的概率。

2. `dbinom`函数：
   - 作用：计算二项分布的概率质量函数（Probability Mass Function，PMF）。
   - 示例：假设有一个伯努利试验，成功的概率为0.4，我们想要计算成功次数为3的概率。可以使用 `dbinom(3, 10, 0.4)`，其中，3是成功次数，10是试验的总次数，0.4是成功的概率。

3. `qbinom`函数：
   - 作用：计算二项分布的分位数。
   - 示例：假设有一个伯努利试验，成功的概率为0.2，要求累积概率为0.6对应的成功次数。可以使用 `qbinom(0.6, 10, 0.2)`，其中，0.6是累积概率，10是试验的总次数，0.2是成功的概率。

4. `rbinom`函数：
   - 作用：生成服从二项分布的随机数。
   - 示例：假设有一个伯努利试验，成功的概率为0.5，我们想要生成10个试验结果的随机样本。可以使用 `rbinom(10, 1, 0.5)`，其中，10是要生成的随机样本的数量，1是试验的总次数（每次只进行一次试验），0.5是成功的概率。


#### 例子
1. 某社区有5000人，一天内每人使用共享单车的概率为0.02，不同人是否使用单车相互独立，请问在一天内有100人使用共享单车的概率为多少
   相当于实验次数n为5000，我们利用`dbinom(100, 5000, 0.02)`

2. 某社区有5000人，一天内每人使用共享单车的概率为0.02，不同人是否使用单车相互独立，请问在一天内少于80人使用共享单车的概率为多少？请问在一天内大于120人使用共享单车的概率为多少
   **这种大于小于的**都可以使用`p`，
   - 对于少于80人即0-79`pbinom(79, 5000, 0.02)`
      ```R
      > sum(dbinom(0:79, 5000, 0.02))
      [1] 0.01658478
      > pbinom(79, 5000, 0.02)
      [1] 0.01658478
      ```
   - 大于120即0-120的另一半`1 - pbinom(120, 5000, 0.02)`
      ```R
      > 1 - sum(dbinom(0:120, 5000, 0.02))
      [1] 0.02156227
      > 1 - pbinom(120, 5000, 0.02)
      [1] 0.02156227
      > sum(dbinom(121:5000, 5000, 0.02))
      [1] 0.02156227
      ```


1. 对于某射击测试，规定每人射击10次，至少7次以上射中8环以上才能通过测试，如果某运动员每次射击击中8环以上的概率为0.7，且每次射击之间互不影响，请问该运动员通过测试的概率是
     - `dbinom(7, 10 ,0.7) + dbinom(8, 10 ,0.7) + dbinom(9, 10 ,0.7) + dbinom(10, 10 ,0.7)`，直接计算7、8、9、10的概率和
       - 也可以这样写`sum(dbinom(k, n, p))`，其中`k = 7:n; n = 10; p = 0.7`
     - `1- pbinom(6, 10, 0.7)`这里是积分到6，减去就是7、8、9、10的概率和了

### 泊松分布
**稀有事件**描述，不需要$p$只需要$\lambda$
- 公路每日车祸数量
- 屏幕黑点
- 英国白化病人数
- 一个房间内的蚊子数

$\lambda = np$可以非整数， $x$为$0-\inf$任意整数

#### 公式
$f(x, \lambda) = e^{-\lambda} \frac{\lambda^{x}}{x!} where x=0,1,2...$

#### R function
1. `ppois`: 累积分布函数（CDF）函数，它返回泊松分布的累积概率。给定一个特定的观察值，该函数计算**小于或等于该观察值**的随机变量的**概率**。

2. `dpois`: 概率质量函数（PMF）函数，用于计算**给定一个特定观察值**的泊松分布的**概率**。

3. `qpois`: 分位数函数，给定一个概率值，该函数返回泊松分布中的对应分位数。例如，给定0.95，该函数将返回泊松分布的第95个百分位数。

4. `rpois`: 随机数生成函数，用于根据给定的参数生成符合泊松分布的随机样本。可以使用该函数生成模拟数据。

#### 例子
1. 某餐厅每月被投诉的次数服从参数为2的泊松分布，请问某个月份被投诉4次的概率为多少？每月被投诉次数大于3次的概率为多少
    ```R
    lambda <- 2 # 泊松分布的参数

    # 计算被投诉4次的概率
    prob_4 <- dpois(4, lambda)

    # 计算被投诉次数大于3次的概率
    prob_greater_than_3 <- 1 - ppois(3, lambda)

    prob_4
    prob_greater_than_3
    ```

2. 曹安公路上每天发生交通事故的次数服从参数为3的泊松分布，请问曹安公路上每天交通事故次数大于6次的概率为多少
    ```R
    lambda <- 3 # 泊松分布的参数
    prob <- 1 - ppois(6, lambda) # 计算概率
    ```

### 几何分布
求解首次成功需要的实验次数x的概率
#### 公式
$P{X = k} = (1-p)^{k-1}p$失败k-1次，第k次才成功
$E(X) = \frac{1}{p}$
$Var(X) = \frac{1 - p}{p^2}$
#### 例子
对于某射击测试，可以最多射击10次，射中8环以上就算通过，如果某学生每次射击击中8环以上的概率为0.2，每次射击之间互不影响
- 第一次通过测试的概率
- 第十次才通过测试的概率
- 无法通过测试的概率
```R
p <- 0.2 # 成功的概率
k <- 1 # 第k次尝试

# 计算学生第1次通过测试的概率
prob_pass_1 <- dgeom(k, p)

# 计算学生第10次才通过测试的概率
k <- 10
prob_pass_10 <- dgeom(k, p)

# 计算学生无法通过测试的概率
prob_fail <- 1 - pgeom(10, p)

prob_pass_1
prob_pass_10
prob_fail
```
### 负二项分布
求解$r$次成功需要的实验次数$x$的概率
$NB(r,p)$
描述在**固定次数**的独立伯努利试验中，直到**出现指定次数的成功**事件**所需要的失败次数**的概率分布
#### R function
1. pnbinom(q, size, prob)：
   pnbinom函数计算负二项分布的累积分布函数（Cumulative Distribution Function，CDF）。给定失败次数的阈值q，大小参数size和成功概率参数prob，该函数返回失败次数小于或等于q的概率值。
   
   例如，pnbinom(2, 5, 0.3)将返回在5次独立伯努利试验中，失败次数小于或等于2的概率值。

2. dnbinom(x, size, prob)：
   dnbinom函数计算负二项分布的概率质量函数（Probability Mass Function，PMF）。给定失败次数x，大小参数size和成功概率参数prob，该函数返回失败次数x的概率值。
   
   例如，dnbinom(3, 5, 0.3)将返回在5次独立伯努利试验中，失败次数为3的概率值。

3. qnbinom(p, size, prob)：
   qnbinom函数计算负二项分布的分位数函数（Quantile Function）。给定概率值p，大小参数size和成功概率参数prob，该函数返回使得失败次数小于或等于该概率的最小整数值。
   
   例如，qnbinom(0.5, 5, 0.3)将返回在5次独立伯努利试验中，失败次数小于或等于0.5的最小整数值。

4. rnbinom(n, size, prob)：
   rnbinom函数生成符合负二项分布的随机数。给定生成的随机数个数n，大小参数size和成功概率参数prob，该函数返回一个长度为n的负二项分布的随机数向量。
   
   例如，rnbinom(10, 5, 0.3)将返回一个包含10个在5次独立伯努利试验中生成的负二项分布的随机数的向量。

#### 例子
1. 某城市二胎家庭概率为0.3，随机访问，访问到第10个家庭是第3个二胎家庭的概率是多少
### 指数分布
独立随机事件发生的时间间隔，如旅客进机场的
时间间隔、中文维基百科新条目出现的时间间隔
、事故发生的时间间隔和电子产品的寿命分布
#### R function
1. `pexp()`函数：计算指数分布的累积分布函数（CDF），给出随机变量取值小于或等于给定值的概率。

   示例：
   ```R
   # 计算指数分布的累积分布函数
   x <- 2  # 给定值
   rate <- 0.5  # 指数分布的速率参数
   prob <- pexp(x, rate)
   print(prob)
   ```
   上述代码计算了速率为0.5的指数分布，在取值小于或等于2的情况下的概率。

2. `dexp()`函数：计算指数分布的概率密度函数（PDF），给出指定值处的概率密度。

   示例：
   ```R
   # 计算指数分布的概率密度函数
   x <- 2  # 指定值
   rate <- 0.5  # 指数分布的速率参数
   prob_density <- dexp(x, rate)
   print(prob_density)
   ```
   上述代码计算了速率为0.5的指数分布，在取值为2处的概率密度。

3. `qexp()`函数：计算指数分布的分位点，即给定概率下的随机变量取值。

   示例：
   ```R
   # 计算指数分布的分位点
   prob <- 0.3  # 给定概率
   rate <- 0.5  # 指数分布的速率参数
   quantile <- qexp(prob, rate)
   print(quantile)
   ```
   上述代码计算了速率为0.5的指数分布，在累积分布函数值为0.3的情况下的分位点。

4. `rexp()`函数：生成符合指数分布的随机变量。

   示例：
   ```R
   # 生成符合指数分布的随机变量
   n <- 100  # 随机变量个数
   rate <- 0.5  # 指数分布的速率参数
   random_values <- rexp(n, rate)
   print(random_values)
   ```
   上述代码生成了100个速率为0.5的指数分布的随机变量。

### 卡方分布
标准正态分布的平方和

1. **卡方检验（Chi-square test）**：卡方分布用于比较**观测值与期望值之间的偏差**，从而判断两个分类变量之间是否存在显著关联或依赖关系。卡方检验常用于分析列联表数据（也称为交叉表或列联矩阵），例如检验两个变量之间的关联性或比较不同组别中的观察频数。

2. **拟合优度检验（Goodness-of-fit test）**：卡方分布还常用于**检验观测数据是否符合某种理论分布模型的假设**。通过比较观测频数与期望频数之间的差异，可以评估数据的拟合度。这在确定数据是否符合特定分布假设或模型选择方面非常有用。

3. **建立置信区间（Confidence intervals）**：基于卡方分布，可以构建二项分布参数、方差分析和回归模型中参数的置信区间。置信区间提供了对参数估计的不确定性范围估计，有助于推断问题的解释和结果的解释。

#### R function
1. **pchisq()函数**：该函数用于计算卡方分布的累积概率值（即累积分布函数的值）。它接受两个参数：q（观测值）和 df（自由度）。其中，q表示要计算累积概率的值，df表示卡方分布的自由度。函数返回一个介于0和1之间的概率值。

   例如，计算自由度为5的卡方分布在观测值为10时的累积概率值可以使用以下代码：
   ```R
   p_value <- pchisq(10, df = 5)
   ```

2. **dchisq()函数**：该函数用于计算卡方分布的概率密度值（即概率密度函数的值）。它接受两个参数：x（要计算概率密度的值）和 df（自由度）。函数返回相应x值处的概率密度值。

   例如，计算自由度为3的卡方分布在x=2处的概率密度值可以使用以下代码：
   ```R
   density <- dchisq(2, df = 3)
   ```
   
3. **qchisq()函数**：该函数用于计算卡方分布的分位数（即反函数）。给定一个概率值和自由度，函数返回对应的分位数值。

   例如，计算自由度为7的卡方分布的上分位点（95%的分位数）可以使用以下代码：
   ```R
   quantile <- qchisq(0.95, df = 7)
   ```

4. **rchisq()函数**：该函数用于生成服从卡方分布的随机数。它接受一个参数n（生成的随机数的数量）和 df（自由度）。函数返回一个长度为n的随机数向量。

   例如，生成500个自由度为4的卡方分布的随机数可以使用以下代码：
   ```R
   random_vals <- rchisq(500, df = 4)
   ```

### 伽马分布
$Ga(\alpha, \lambda)$
$E(X) = \frac{\alpha}{\lambda}$
$Var(X) = \frac{\alpha}{\lambda ^ 2}$

年降水量、最大风速

1. **可靠性分析**：伽马分布常用于可靠性分析，特别是故障时间数据分析。通过拟合伽马分布到故障时间数据，可以估计设备或系统的可靠性参数，如平均故障时间、故障率等，从而评估其可靠性和预测未来的故障情况。

2. **风险评估**：伽马分布在风险评估中也有应用。例如，假设某个投资组合的投资收益率符合伽马分布，可以使用伽马分布的参数来估计该投资组合的风险水平，如价值-at-Risk (VaR) 等。

3. **保险精算**：在保险精算中，伽马分布经常用于对保险理赔金额进行建模。通过估计伽马分布的参数，可以估计保险理赔金额的分布特征，从而帮助保险公司进行风险评估、资本需求估计等。

4. **生存分析**：生存分析是研究个体在给定时间段内生存或失败的分析方法。伽马分布可以用于建模生存时间数据，如医学研究中的患者存活时间、设备故障时间等。通过伽马分布，可以估计生存函数、风险函数以及预测未来的生存概率。

5. **排队理论**：在排队理论中，伽马分布经常用于模拟和分析到达时间和服务时间。通过使用伽马分布，可以对服务系统的吞吐量、延迟时间、效率等进行分析和优化，以帮助提高服务质量和效能。
#### R function
1. **pgamma**：伽马分布的分布函数（cumulative distribution function）。它给出了伽马分布累积概率函数的值，表示随机变量小于或等于给定值的概率。

   示例：
   ```R
   # 计算伽马分布在 x = 2 的累积概率
   p <- pgamma(2, shape = 2, rate = 1)
   print(p)
   ```

2. **dgamma**：伽马分布的概率密度函数（probability density function）。它给出了给定值处的概率密度值，描述了随机变量在该点附近取值的可能性。

   示例：
   ```R
   # 计算伽马分布在 x = 2 处的概率密度
   d <- dgamma(2, shape = 2, rate = 1)
   print(d)
   ```

3. **qgamma**：伽马分布的分位数函数（quantile function）。它给出了给定概率值对应的分位数，即在给定概率下，随机变量的取值不超过该分位数。

   示例：
   ```R
   # 计算伽马分布的上 α 分位数，其中 α = 0.8
   q <- qgamma(0.8, shape = 2, rate = 1)
   print(q)
   ```

4. **rgamma**：生成伽马分布的随机变量。它根据给定的参数生成符合伽马分布的随机样本。

   示例：
   ```R
   # 生成一个服从伽马分布的随机样本，其中样本个数为 100，参数为 shape = 2, rate = 1
   r <- rgamma(100, shape = 2, rate = 1)
   print(r)
   ```

## 参数估计
### 最大似然估计
#### likelihood function
$L(x_1, x_2, ..., x_n, \theta) = \Pi^n_{i=1}f(x_i, \theta)$
#### maxium likelihood estimates(MLE)
[zhihu](https://zhuanlan.zhihu.com/p/45421484)
[MLEdoc](https://runebook.dev/zh/docs/r/library/stats4/html/mle)
MLE可以帮助我们确定给定数据的分布参数（例如看着数据似乎遵循正态分布，那么如何获得平均值和标准差呢）
[fitdistr](https://www.rdocumentation.org/packages/MASS/versions/7.3-58.3/topics/fitdistr)
在R语言中，`fitdistr()`函数用于拟合给定数据集的参数化概率分布。它可通过最大似然估计（MLE）来估计参数值，从而使得给定数据集与拟合的概率分布尽可能相匹配。

以下是`fitdistr()`函数的基本用法：

```R
fitdistr(data, densfun, start = NULL, ...)
```

参数说明：
- `data`：要拟合概率分布的观测数据。
- `densfun`：要拟合的概率密度函数。这可以是一个内置的概率分布函数（如正态分布`dnorm()`、伽马分布`dgamma()`等），也可以是自定义的函数。
- `start`：可选的参数初始值。如果未提供，将使用默认初始值。
- `...`：可选的其他参数，可传递给概率密度函数。

示例：

```R
# 导入拟合概率分布的包
library(MASS)

# 生成正态分布的随机样本
set.seed(1)
data <- rnorm(100)

# 使用fitdistr拟合正态分布
fit <- fitdistr(data, densfun = "normal")

# 输出估计得到的参数值
estimated_params <- fit$estimate
print(estimated_params)
```

请注意，通过`fitdistr()`函数拟合概率分布时，需要注意选择合适的概率密度函数和初始参数值。也要记得对拟合结果进行评估，例如通过查看参数的标准误差、拟合优度统计量等来评估拟合的质量。此外，不同的分布有不同的参数要求，因此在使用`fitdistr()`函数时，请确保熟悉所选概率分布的参数要求和假设。


## 拟合优先度检验